<!DOCTYPE html>
<html lang="en-us">
    <head>
         
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>test</title>
        
        <style>

    html body {
        font-family: 'Raleway', sans-serif;
        background-color: white;
    }

    :root {
        --accent: red;
        --border-width:  5px ;
    }

</style>


<link rel="stylesheet" href="https://snamiki1212.github.io/til/css/main.css">





<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">


 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/solarized-dark.min.css"> 


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
 


    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>

     <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/go.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/haskell.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/kotlin.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/scala.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/swift.min.js"></script> 

    <script>hljs.initHighlightingOnLoad();</script>







<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


<script>$(document).on('click', function() { $('.collapse').collapse('hide'); })</script>
 <meta name="generator" content="Hugo 0.42.1" />
        

        
    </head>

    
    
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    

    <body>
         
        <nav class="navbar navbar-default navbar-fixed-top">

            <div class="container">

                <div class="navbar-header">

                    <a class="navbar-brand visible-xs" href="#">test</a>

                    <button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>

                </div>

                <div class="collapse navbar-collapse">

                    
                        <ul class="nav navbar-nav">
                            
                                <li><a href="/til/">Home</a></li>
                            
                                <li><a href="/til/elixir/">Elixir</a></li>
                            
                                <li><a href="/til/project/">Projects</a></li>
                            
                        </ul>
                    

                    
                        <ul class="nav navbar-nav navbar-right">
                            
                                <li class="navbar-icon"><a href="mailto:me@example.com"><i class="fa fa-envelope-o"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://github.com/username/"><i class="fa fa-github"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://twitter.com/username/"><i class="fa fa-twitter"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://www.linkedin.com/in/username/"><i class="fa fa-linkedin"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://www.stackoverflow.com/username/"><i class="fa fa-stack-overflow"></i></a></li>
                            
                        </ul>
                    

                </div>

            </div>

        </nav>


<main>

    <div class="item">

    
    
    

    
    

    <h4><a href="/til/elixir/test/">test</a></h4>
    <h5>July 5, 2018</h5>
    
    <a href="https://snamiki1212.github.io/tiltags/til"><kbd class="item-tag">TIL</kbd></a>
    
    <a href="https://snamiki1212.github.io/tiltags/elixir"><kbd class="item-tag">Elixir</kbd></a>
    
    <a href="https://snamiki1212.github.io/tiltags/test"><kbd class="item-tag">Test</kbd></a>
    
    <a href="https://snamiki1212.github.io/tiltags/exunit"><kbd class="item-tag">ExUnit</kbd></a>
    
    <a href="https://snamiki1212.github.io/tiltags/phoenix"><kbd class="item-tag">Phoenix</kbd></a>
    
    <a href="https://snamiki1212.github.io/tiltags/ecto"><kbd class="item-tag">Ecto</kbd></a>
    

</div>


    <br> <div class="text-justify">

<h2 id="exunit">ExUnit</h2>

<blockquote>
<p>Unit testing framework for Elixir</p>
</blockquote>

<ul>
<li><p><a href="https://hexdocs.pm/ex_unit/ExUnit.html">公式ドキュメント</a>の説明が簡潔・具体列付き・短文で一番概要がわかりやすい。その上で詳細な使い方は<a href="https://qiita.com/Joe-noh/items/ddd6cf3f38c8f841e90a">ExUnit入門</a>を見るとよさげ。</p></li>

<li><p>async option</p></li>
</ul>

<p><code>async</code>optionをtrueしているすると、非同期実行される。つまり、全テストが並列に実行される。</p>

<pre><code>  ...
  use ExUnit.Case, async: true
  ...
</code></pre>

<h2 id="phoenix">Phoenix</h2>

<p>PhoenixでExUnitをwrappingして使われるので<a href="https://hexdocs.pm/phoenix/testing.html">Phoenix - Introduction to Testing</a>を見ておくとPhoenix経由での使い方の概要がわかる
- <code>test/test_helper.exs</code>にてdatabaseのcreate/migrationを行う。<code>mix test</code>毎に行われるので、毎回のテストにてcleanされる。
- <code>test/support</code>配下のmoduleはテスト可能状態にするための機能群で、具体的にはコネクション確立やEctoChangesetのエラー発見？など
- mix commands</p>

<pre><code class="language-terminal">  ## test all files
  mix test

  ## test all files under directory-path
  mix test &lt;directory-path&gt;

  ## test target file
  mix test &lt;file-path&gt;

  ## test target file and target line
  mix test &lt;file-path&gt;:&lt;line&gt;

  ## test with this tag
  mix test --only &lt;tag&gt;
</code></pre>

<h3 id="ecto-adapters-sql-sandbox">Ecto.Adapters.SQL.Sandbox</h3>

<p>EctoのAdapterの１つでテスト専用で使用するもの（Adapterは「適合させるもの」の意味のままの通りで、<code>Ecto</code>ライブラリと<code>Sandbox(PostgreSQL or MySQL)</code>を適合させる。他のAdapterには<code>MySQL</code>や｀PostgreSQLがある）</p>

<blockquote>
<p>A pool for concurrent transactional tests.</p>
</blockquote>

<ul>
<li>dbへの並列アクセスを安全に行うための機構

<ul>
<li>dbへの接続にてcheckoutを明示する</li>
<li>connectionをwrapしてる</li>
</ul></li>
<li><code>manual</code> / <code>shared</code> の2modeがある。違いは下記の2点。

<ol>
<li>cuncurently testable: テスト全体でテストの並列実行の可否</li>
<li>explicit allowances: テスト前にcheckoutしたrepoへのアクセス権を、テスト中にspawnしたprocessに明示的に渡す必要があるか？
<br /></li>
</ol></li>
</ul>

<p>|   | <code>manual</code>mode(Using allowances) | <code>shared</code>mode |
  |  &mdash;&mdash; | &mdash;&mdash; | &mdash;&mdash; |
  |  cuncurently testable | 可能 | 不可能 |
  |  explicit allowances | あり | なし |</p>

<ul>
<li>サポート
<code>
While both PostgreSQL and MySQL support SQL Sandbox, only PostgreSQL supports concurrent tests while running the SQL Sandbox. Therefore, do not run concurrent tests with MySQL as you may run into deadlocks due to its transaction implementation.
</code>

<ul>
<li>◯：PostgreSQL</li>
<li>△：MySQL</li>
<li>並列テストはPostgreSQLではサポートしてるけど、MySQLではサポートしていないので行うな。deadlockが発生するかもしれないから(v2.2.10時点)</li>
</ul></li>
</ul>

<h2 id="reference">Reference</h2>

<h3 id="exunit-1">ExUnit</h3>

<ul>
<li><a href="https://hexdocs.pm/ex_unit/ExUnit.html">公式ドキュメント</a></li>
<li><a href="https://qiita.com/Joe-noh/items/ddd6cf3f38c8f841e90a">ExUnit入門</a></li>
</ul>

<h3 id="phoenix-ecto">Phoenix / Ecto</h3>

<ul>
<li><a href="https://hexdocs.pm/phoenix/testing.html">Phoenix - Introduction to Testing</a></li>
<li><a href="https://hexdocs.pm/ecto/Ecto.Adapters.SQL.Sandbox.html">Ecto - Ecto.Adapters.SQL.Sandbox</a></li>
</ul>

<h3 id="doctest">doctest</h3>

<ul>
<li><a href="https://elixir-lang.org/getting-started/mix-otp/docs-tests-and-with.html">公式ドキュメント</a>（公式日本語訳は無かった）</li>
<li><a href="https://qiita.com/ma2ge/items/b6b26335ecc1b2181897">Elixir の doctest 書き方まとめ</a></li>
</ul>
</div>

    
    

    

    

        <h4 class="page-header">Comments</h4>

        <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "username" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    

</main>

        <footer>

            <p class="copyright text-muted">&copy; All rights reserved. Powered by <a href="https://gohugo.io">Hugo</a> and <a href="https://github.com/calintat/minimal">Minimal</a></p>

        </footer>
       
    </body>

</html>

